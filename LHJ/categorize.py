import pandas as pd

df = pd.read_csv("통합_학과별_장학금_10-20.csv")

# 컬럼 설정
df = df.copy()
df.columns = df.iloc[0]

# 필요 데이터만 남기기
df = df[3:]
df = df.iloc[:,:5]
df = df.reset_index(drop = True)
df = df.dropna(subset = ["학과"])

df.columns = ['기준연도', '학교명', '학과', '재학생', '1인당장학금']


# 비어있는 값 이전 행 값 삽입
df['기준연도'] = df['기준연도'].fillna(method='ffill')
df['학교명'] = df['학교명'].fillna(method='ffill')

# 쉼표 제거
df['재학생']= df['재학생'].str.replace(',', '', regex=False)
df['1인당장학금'] = df['1인당장학금'].astype(str).str.replace(',', '', regex=False) # 문자열 변환후 제거

df['기준연도'] = df['기준연도'].astype(int)
df['재학생'] = df['재학생'].astype(int)
df['1인당장학금'] = df['1인당장학금'].astype(float)

# 사이버대학 제외
df = df[~df['학교명'].str.contains("디지털", na=False)]

# 계열별 키워드 목록
category_keywords = {
    "의학": [
        "간호", "의료", "의학", "약학", "보건", "치위생", "치과", "응급", "응급구조", "방사선",
        "물리치료", "작업치료", "임상병리", "치기공", "의무", "재활", "의예", "한의학", "한의예", "의공학",
        "안경광학", "언어치료", "청각", "생명의과", "제약"
    ],
    "인문": [
        "국어", "영어", "일본", "중국", "독일", "불어", "프랑스", "스페인", "문예", "문학", "사학", "철학", "고전",
        "심리", "사회", "사회복지", "청소년", "미디어", "저널리즘", "신문방송", "커뮤니케이션", "행정", "정치", "외교",
        "국제", "법학", "경찰", "범죄", "보안", "경호", "교육", "유아교육", "초등교육", "특수교육", "사범", "상담",
        "경영", "경제", "무역", "회계", "세무", "재무", "금융", "마케팅", "e-비즈니스", "광고홍보",
        "관광", "호텔", "항공서비스", "카지노", "여행", "레저", "문화", "종교", "신학", "신앙", "복지", "아동", "일어",
        "중어", "인문"
    ],
    "자연과학": [
        "수학", "통계", "물리", "화학", "생물", "생명", "자연", "지구과학", "천문", "과학", "식품", "농업", "축산",
        "원예", "바이오", "해양", "수산", "양식", "환경", "응용과학", "에코", "자원생물"
    ],
    "공학": [
        "공학", "컴퓨터", "소프트웨어", "정보", "통신", "정보통신", "IT", "AI", "인공지능", "데이터", "프로그래밍",
        "전자", "전기", "제어", "반도체", "기계", "자동차", "항공", "로봇", "메카트로닉스", "산업", "생산", "물류",
        "시스템", "토목", "건축", "도시", "조경", "인테리어", "자원", "에너지", "화공", "신소재", "나노", "융합기술",
        "3D", "용접", "CAD", "건설"
    ],
    "예체능": [
        "디자인", "패션", "의상", "뷰티", "미용", "시각", "공예", "조형", "미술", "회화", "조소", "사진",
        "영상", "애니메이션", "웹툰", "영화", "연극", "뮤지컬", "방송", "성악", "실용음악", "작곡", "기악",
        "피아노", "음악", "국악", "댄스", "무용", "체육", "스포츠", "태권도", "유도", "운동처방", "레저스포츠",
        "생활체육", "스포츠재활", "무도", "조리", "제과", "제빵", "한식", "양식", "중식", "외식", "식음료"
    ]
}

# 학과명을 계열로 분류하는 함수
def categorize(dept_name):
    if pd.isna(dept_name):
        return "미분류"
    for category, keywords in category_keywords.items():
        if any(keyword in str(dept_name) for keyword in keywords):
            return category
    return "미분류"

# 계열 분류 컬럼 추가
df["계열"] = df["학과"].apply(categorize)

# CSV로 저장
df.to_csv("계열_자동분류_10-20.csv", index=False, encoding="utf-8-sig")